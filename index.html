<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>入力テスト用ページ</title>
  <style>
    html, body { height: 100%; margin: 0; padding: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, 'Noto Sans JP', 'Yu Gothic UI', Meiryo, sans-serif; }
    .wrapper { display: flex; flex-direction: column; height: 100%; width: 100%; }
    .textarea-wrap { flex: 1 1 auto; padding: 12px; box-sizing: border-box; }
    textarea { width: 100%; height: 100%; box-sizing: border-box; resize: none; font-size: 18px; line-height: 1.6; padding: 12px; }
    .footer { flex: 0 0 auto; padding: 12px; border-top: 1px solid #ddd; position: sticky; bottom: 0; background: #fff; }
    button { width: 100%; padding: 14px 18px; font-size: 16px; border: 1px solid #ccc; border-radius: 8px; cursor: pointer; background: #f6f6f6; }
    .hint { font-size: 12px; color: #666; margin-top: 8px; }
    .toast { position: fixed; right: 12px; bottom: 12px; background: #333; color: #fff; padding: 10px 12px; border-radius: 8px; opacity: 0.95; display: none; }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="textarea-wrap">
      <textarea id="editor" placeholder="ここにテキストを入れてください。"></textarea>
    </div>
    <div class="footer">
      <button id="copyBtn" type="button">クリップボードへコピー</button>
      <div class="hint">
        ※ HTTPS 環境（GitHub Pages 等）または localhost であれば、クリック操作でクリップボードへコピーできます。<br />
        ※ コピー後はネイティブアプリ側で <kbd>Ctrl</kbd>+<kbd>V</kbd> 等でペーストしてください。
      </div>
    </div>
  </div>
  <div id="toast" class="toast" role="status" aria-live="polite">コピーしました</div>
  <script>
    const ta = document.getElementById('editor');
    const copyBtn = document.getElementById('copyBtn');
    const toast = document.getElementById('toast');

    function showToast(msg) {
      toast.textContent = msg;
      toast.style.display = 'block';
      setTimeout(() => { toast.style.display = 'none'; }, 1500);
    }

    async function copyText(text) {
      // Try modern API first
      if (navigator.clipboard && window.isSecureContext) {
        await navigator.clipboard.writeText(text);
        return true;
      }
      // Fallback for non-secure contexts: execCommand
      try {
        const selStart = ta.selectionStart, selEnd = ta.selectionEnd;
        const prev = ta.value;
        ta.select();
        const ok = document.execCommand('copy');
        // restore selection/caret
        ta.value = prev;
        ta.selectionStart = selStart;
        ta.selectionEnd = selEnd;
        ta.focus();
        return ok;
      } catch (e) {
        return false;
      }
    }

    copyBtn.addEventListener('click', async () => {
      const text = ta.value;
      try {
        const ok = await copyText(text);
        if (ok) {
          showToast('コピーしました');
        } else {
          alert('クリップボードへのコピーに失敗しました。HTTPS(またはlocalhost)での実行をご確認ください。');
        }
      } catch (err) {
        alert('クリップボードへのコピーでエラーが発生しました:\n' + err);
      }
    });

    window.addEventListener('DOMContentLoaded', () => { ta.focus(); });
  </script>
</body>
</html>
